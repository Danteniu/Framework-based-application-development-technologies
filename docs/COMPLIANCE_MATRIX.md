## Матрица соответствия ТЗ — «СистемаКонтроля»

Формат: **Требование → Статус → Где в коде → Как проверить**.

---

### FR-1 Регистрация пользователей и аутентификация
- **Статус**: выполнено
- **Код**: `accounts/views.py`, `accounts/urls.py`, `templates/accounts/login.html`, `templates/accounts/register.html`
- **Проверка**:
  - Открыть `/accounts/register/` → зарегистрировать пользователя.
  - Открыть `/accounts/login/` → войти → редирект на `/`.

### FR-2 Разграничение прав доступа (менеджер/инженер/наблюдатель)
- **Статус**: выполнено
- **Код**: `accounts/models.py` (`User.role`), проверки в `defects/views.py`, `projects/views.py`, `reports/views.py`
- **Проверка**:
  - Наблюдатель не видит кнопки “Создать/Редактировать”, не может POST‑ить (редирект/ошибка).
  - Инженер видит только свои дефекты; не может закрывать/отменять.
  - Менеджер может назначать/закрывать/удалять объекты/этапы.

### FR-3 Управление проектами/объектами и этапами
- **Статус**: выполнено
- **Код**:
  - Модели: `projects/models.py` (`Project`, `Stage`)
  - UI/CRUD: `projects/views.py`, `projects/urls.py`, `templates/projects/list.html`, `templates/projects/stages.html`
- **Проверка**:
  - Менеджер: создать/редактировать/удалить объект и этап.
  - Удаление объекта/этапа с дефектами блокируется (сообщение о связях).

### FR-4 Создание и редактирование дефектов (поля, исполнитель, сроки, вложения)
- **Статус**: выполнено
- **Код**: `defects/models.py`, `defects/forms.py`, `defects/views.py`, `templates/defects/form.html`, `templates/defects/detail.html`
- **Проверка**:
  - Менеджер: создаёт дефект с исполнителем/сроком.
  - Инженер: создаёт дефект без назначения (поля скрыты) и не может менять назначение/срок.
  - Вложения загружаются и отображаются в карточке дефекта.

### FR-5 Управление статусами дефектов (Новая → В работе → На проверке → Закрыта/Отменена)
- **Статус**: выполнено
- **Код**: `defects/models.py` (`allowed_next_statuses`), `defects/views.py` (`change_status`)
- **Проверка**:
  - Невалидный переход статуса запрещён.
  - Инженер меняет статус только у назначенного ему дефекта.
  - Закрытие/отмена доступны только менеджеру.

### FR-6 Комментарии и история изменений
- **Статус**: выполнено
- **Код**: `defects/models.py` (`DefectComment`, `DefectHistory`), `defects/services.py`, `templates/defects/detail.html`
- **Проверка**:
  - Добавить комментарий → появляется в карточке.
  - Изменить статус/поля → появляются записи в истории.

### FR-7 Поиск, сортировка и фильтрация дефектов
- **Статус**: выполнено
- **Код**: `defects/views.py` (Q‑фильтр, сортировки), `templates/defects/list.html`
- **Проверка**:
  - Поиск по заголовку/описанию.
  - Фильтр по объекту/статусу/приоритету.
  - Сортировка по дате/сроку/приоритету.

### FR-8 Экспорт отчётности в CSV/Excel
- **Статус**: выполнено
- **Код**: `reports/views.py`, `reports/excel.py`
- **Проверка**:
  - В списке дефектов нажать “Экспорт CSV/Excel” → скачивается файл.
  - Фильтры/сортировка пробрасываются в экспорт (query string).

### FR-9 Аналитические отчёты (графики/статистика)
- **Статус**: выполнено (базовый дашборд)
- **Код**: `reports/views.py` (`dashboard`), `templates/reports/dashboard.html` (Chart.js)
- **Проверка**:
  - Менеджер/наблюдатель открывает `/reports/dashboard/` и видит график по статусам.

---

## Нефункциональные требования (NFR)

### NFR-1 Время отклика ≤ 1 сек (50 активных пользователей)
- **Статус**: подготовлена методика/инструмент
- **Код/артефакты**: `locustfile.py`, инструкция в `README.md`
- **Проверка**:
  - Запустить Locust, поставить 50 пользователей, измерить latency основных страниц.

### NFR-2 Резервное копирование БД раз в сутки
- **Статус**: выполнено
- **Код**: `core/management/commands/backup_db.py`, `scripts/backup.ps1`, `README.md`
- **Проверка**:
  - `python manage.py backup_db` создаёт файл в `backups/`.
  - Планировщик задач Windows запускает `scripts/backup.ps1` ежедневно.

### NFR-3 RU интерфейс, адаптивность
- **Статус**: выполнено
- **Код**: Bootstrap в `templates/base.html`, `LANGUAGE_CODE` в `sistemakontrolya/settings.py`
- **Проверка**:
  - Открыть на разных ширинах экрана (ПК/планшет) — меню и таблицы адекватны.

### NFR-4 Совместимость Chrome/Firefox/Edge
- **Статус**: выполняется архитектурно (стандартный HTML/Bootstrap)
- **Проверка**:
  - Открыть приложение в перечисленных браузерах.

### NFR-5 Пароли bcrypt/argon2
- **Статус**: выполнено (argon2)
- **Код**: `sistemakontrolya/settings.py` (`PASSWORD_HASHERS`)

### NFR-6 Защита SQLi/XSS/CSRF
- **Статус**: выполнено базовыми механизмами Django + серверные проверки
- **Код**: ORM (везде), autoescape в шаблонах, `CsrfViewMiddleware` в `sistemakontrolya/settings.py`


